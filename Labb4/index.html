<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Chat App</title>

  <link rel="stylesheet" href="css/styles.css?v=1.0">

</head>

<body>
  <h1>Chat app</h1>
  <h2>Messages:</h2>
  <div id="messages">
    messages here
  </div>
  <button onclick="loadMessages()">Load Messages</button>
  <p id=”heading”></p>

  <textarea name="messagebox" rows="10" cols="30">The cat was playing in the garden.</textarea>
  <br>
  <button id="postMsg" onclick="publish">Send</button>
</body>

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.7.js"></script>


<!-- Instantiate PubNub -->
<script type="text/javascript">

var pubnubDemo = new PubNub({

publishKey: 'pub-c-701807e9-652b-4981-9bef-a6024c7daefd',

subscribeKey: 'sub-c-543d2354-6bff-11e9-81d5-56c3556875f9'

});

var currentHeading;

// 'north', 'south', 'east', 'west'

function getDirection(degrees) {

  if(degrees <= 45 || degrees > 315) {
    return 'north';
  } else if(degrees > 45 && degrees < 135) {
    return 'east';
  } else if(degrees >= 135 && degrees < 225) {
    return 'south';
  } else {
    return 'west'
  }
}

// Publish a simple message to the “demo_tutorial” channel pubnub:
function publish() {
  var messagetxt = document.getElementById("messagebox").innerHTML;
  var direction = getDirection(currentHeading);
  pubnubDemo.publish({ message: { "color" : messagetxt }, channel: direction });

}
function loadMessages() {
  var direction = getDirection(currentHeading);
  pubnubDemo.subscribe({ channels: [direction]} );
}

pubnubDemo.addListener({
  message: function(message){
    console.log(message)
    document.getElementById("messages").innerHTML += '<br> ' + message;
  }
});

// Get event data
function deviceOrientationListener(event) {
  var alpha   = event.alpha; //z axis rotation [0,360)
  var beta     = event.beta; //x axis rotation [-180, 180]
  var gamma   = event.gamma; //y axis rotation [-90, 90]

  //Check if absolute values have been sent
  if (typeof event.webkitCompassHeading !== "undefined") {
    alpha = event.webkitCompassHeading; //for iOS devices
    var heading = alpha
    document.getElementById("heading").innerHTML = heading.toFixed([0]);
    currentHeading = heading.toFixed([0]);
  }
  else {
    alert("Your device is reporting relative alpha values, so this compass won't point north :(");
    var heading = 360 - alpha; //heading [0, 360)
    document.getElementById("heading").innerHTML = heading.toFixed([0]);
    currentHeading = heading.toFixed([0]);

  }
}

</script>

</html>
