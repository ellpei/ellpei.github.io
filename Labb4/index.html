<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Chat App</title>

  <link rel="stylesheet" href="styles.css?v=1.0">

</head>

<body>
  <h1>Chat app</h1>

  <div id="chatarea">
    <h2 id="chatroom">Chat Room:</h2>
    <div id="box"></div>
  </div>
  <p>Enter chat and press enter.</p>
  <input id="input" placeholder="Your Message Here"/>

  <p id="heading"></p>
</body>

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.23.0.min.js"></script>


<!-- Instantiate PubNub -->
<script>

var pubnub = new PubNub({

publishKey: 'pub-c-701807e9-652b-4981-9bef-a6024c7daefd',

subscribeKey: 'sub-c-543d2354-6bff-11e9-81d5-56c3556875f9'

});

var currentHeading;
window.addEventListener("deviceorientation", deviceOrientationListener, true);

function getDirection(degrees) {

  if(degrees <= 45 || degrees > 315) {
    return 'north';
  } else if(degrees > 45 && degrees < 135) {
    return 'east';
  } else if(degrees >= 135 && degrees < 225) {
    return 'south';
  } else {
    return 'west'
  }
}
(function(){

  var box = document.getElementById("box"), input = document.getElementById("input"), channel = getDirection(

    // Get event data
    function deviceOrientationListener(event) {
      var alpha   = event.alpha; //z axis rotation [0,360)
      var beta     = event.beta; //x axis rotation [-180, 180]
      var gamma   = event.gamma; //y axis rotation [-90, 90]

      //Check if absolute values have been sent
      if (typeof event.webkitCompassHeading !== "undefined") {
        alpha = event.webkitCompassHeading; //for iOS devices
        var heading = alpha
        document.getElementById("heading").innerHTML = heading.toFixed([0]);
        currentHeading = heading.toFixed([0]);
      }
      else {
        var heading = 360 - alpha; //heading [0, 360)
        document.getElementById("heading").innerHTML = heading.toFixed([0]);
        currentHeading = heading.toFixed([0]);
      }
    }
  );
  pubnub.subscribe({channels: [channel]}); // Subscribe to a channel.
  pubnub.addListener({message: function(m) {
       box.innerHTML = box.innerHTML + 'channel ' + channel + ': ' + (''+m.message).replace( /[<>]/g, '' ) + '<br>'; // Add message to page.
    }});

  input.addEventListener('keypress', function (e) {
      (e.keyCode || e.charCode) === 13 && pubnub.publish({ // Publish new message when enter is pressed.
          channel : channel, message : input.value, x : (input.value='')
      });
  });
})();

// Get event data
function deviceOrientationListener(event) {
  var alpha   = event.alpha; //z axis rotation [0,360)
  var beta     = event.beta; //x axis rotation [-180, 180]
  var gamma   = event.gamma; //y axis rotation [-90, 90]

  //Check if absolute values have been sent
  if (typeof event.webkitCompassHeading !== "undefined") {
    alpha = event.webkitCompassHeading; //for iOS devices
    var heading = alpha
    document.getElementById("heading").innerHTML = heading.toFixed([0]);
    currentHeading = heading.toFixed([0]);
  }
  else {
    var heading = 360 - alpha; //heading [0, 360)
    document.getElementById("heading").innerHTML = heading.toFixed([0]);
    currentHeading = heading.toFixed([0]);
  }
}

</script>

</html>
